<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>用户管理</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.6 -->
    <link rel="stylesheet" href="${siteurl}bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="${siteurl}plugins/FontAwesome/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="${siteurl}plugins/ionicons201/css/ionicons.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="${siteurl}dist/css/AdminLTE.min.css">
    <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="${siteurl}dist/css/skins/_all-skins.min.css">
    <link rel="stylesheet" href="${siteurl}plugins/sweetalert/sweetalert.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    [#include "/admin/common/commons.html"]
</head>
<body class="hold-transition skin-blue sidebar-mini">
<!-- Site wrapper -->
<div class="wrapper">

    <header class="main-header">
        <!-- Header Navbar: style can be found in header.less -->
        [#include "/admin/common/nav.html"]
    </header>

    <!-- =============================================== -->

    <!-- Left side column. contains the sidebar -->
    <aside class="main-sidebar">
        <!-- sidebar: style can be found in sidebar.less -->
        <section class="sidebar">
            <!-- Sidebar user panel -->
            [@user_panel /]
            <!-- search form -->
            [@sidebar_form /]
            <!-- /.search form -->
            <!-- sidebar menu: : style can be found in sidebar.less -->
            <ul class="sidebar-menu">
                <li class="header">主面板</li>
                [@menustag id=1]
                [#list list as item]
                [@menu item "1,20,21"]
                [/@menu]
                [/#list]
                [/@menustag]
            </ul>
        </section>
        <!-- /.sidebar -->
    </aside>

    <!-- =============================================== -->

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                用户信息
                <small>论文添加</small>
            </h1>
        </section>
        <!-- Main content -->
        <section class="content">

            <!-- Default box -->
            <div class="col-xs-12">
                <div class="box box-default box-solid">
                    <div class="box-header with-border">
                        <h3 class="box-title">添加论文信息</h3>
                    </div>
                    <!--隐藏form-->
                    <form class="form-horizontal" id="viewForm" action="${siteurl}admin/member/profile.htm?id=${id!''}" method="post" style="display: none">
                    </form>
                    <!-- /.box-header -->
                    <!-- form start -->
                    <form class="form-horizontal" action="" method="post">
                        <input class="form-control"  name="fileDir" id="fileDirInput" value="" placeholder="" type="text" style="display: none;">
                        <div class="box-body">
                            <div class="form-group">
                                <label class="col-sm-2 control-label">发表日期</label>
                                <div class="col-sm-10">
                                    <input required="required" type="text" name="postDate" class="form-control" id="post_Date" placeholder="">
                                </div>
                            </div>
                            <div class="form-group">
                                <label  class="col-sm-2 control-label">标题</label>
                                <div class="col-sm-10">
                                    <input required="required"  class="form-control"  name="title" placeholder=""  id="paper-title"    type="text">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">作者</label>
                                <div class="col-sm-10">
                                    <input required="required"  class="form-control"  name="author" placeholder=""  id="paper-author"    type="text">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">概要</label>
                                <div class="col-sm-10">
                                    <textarea class="form-control" id="paper-summary" name="summary"
                                              placeholder="" ></textarea>
                                </div>
                            </div>
                            <div class="form-group">
                                <button class="btn btn-primary"  style="
                                margin-top: 40px;width: 120px;height: 40px;margin-left: 120px;" id="upload-btn">上传论文文件</button>
                                <input type="file" class="paper-select-input" name="fileToUpload" id="fileToUpload" onchange="return upLoad()" accept="application/pdf,application/msword" style="
                                    height: 40px;
                                    position: relative;
                                    cursor: pointer;
                                    opacity: 0;
                                    width: 120px;
                                    filter: alpha(opacity=0);
                                    margin-top: -40px;
                                    margin-left: 120px;
                                    display: none;
                            ">
                            </div>

                            <div style="
                                margin-left:  120px;
                                margin-top: 20px;
                            "><a href="/web/dist/paper/608a6a13-df09-410b-ac3d-1f6f657eb1f6.pdf" id="paper-link" target="_blank"></a></div>
                        </div>
                        <!-- /.box-body -->
                        <div class="box-footer" style="margin-top: 60px;">
                            <button class="btn btn-default" id="addPaper-cancel-btn">取消</button>
                            <button type="submit" class="btn btn-info pull-right" id="addPaper-confirm-btn">添加</button>
                        </div>
                        <!-- /.box-footer -->
                    </form>
                </div>
            </div>
            <!-- /.box -->

        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->

    [#include "/admin/common/footer.html"]

    <!-- Control Sidebar -->
    [#include "/admin/common/aside.html"]

    <!-- /.control-sidebar -->
    <!-- Add the sidebar's background. This div must be placed
         immediately after the control sidebar -->
    <div class="control-sidebar-bg"></div>
</div>
<!-- ./wrapper -->

<!-- jQuery 2.2.3 -->
<script src="${siteurl}plugins/jQuery/jquery-2.2.3.min.js"></script>
<script src="${siteurl}plugins/jQuery/ajaxfileupload.js"></script>
<!-- Bootstrap 3.3.6 -->
<script src="${siteurl}bootstrap/js/bootstrap.min.js"></script>
<!-- SlimScroll -->
<script src="${siteurl}plugins/slimScroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="${siteurl}plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="${siteurl}dist/js/app.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="${siteurl}dist/js/demo.js"></script>

<link rel="stylesheet" href="${siteurl}plugins/bootstrap-datepicker/css/bootstrap-datepicker3.css">
<script src="${siteurl}plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
<script src="${siteurl}plugins/bootstrap-datepicker/locales/bootstrap-datepicker.zh-CN.min.js"></script>

<script src="${siteurl}plugins/sweetalert/sweetalert.min.js"></script>

<script>
    $(function() {//
        $('#post_Date').datepicker({
            format: "yyyy-mm-dd",
            todayBtn: true,
            clearBtn: true,
            language: "zh-CN",
            calendarWeeks: true,
            autoclose: true
        });
    });


    $('#addPaper-cancel-btn').click(function(){//阻止form提交
        document.getElementById('viewForm').submit();
        return false;
    });

    $('#addPaper-confirm-btn').click(function(){
        var params={};
        if(null!=$('#fileDirInput').val() && ''!=$('#fileDirInput').val()){
            params.fileDir=$('#fileDirInput').val();
        }else{
            swal("Oops!", "上传文件不能为空", "error");
            return false;
        }
        if(null!=$('#post_Date').val() && ''!=$('#post_Date').val()){
            params.postDate=$('#post_Date').val();
        }else{
            swal("Oops!", "发表日期不能为空", "error");
            return false;
        }

        if(null!=$('#paper-title').val() && ''!=$('#paper-title').val()){
            params.title=$('#paper-title').val();
        }else{
            swal("Oops!", "标题不能为空", "error");
            return false;
        }

        if(null!=$('#paper-author').val() && ''!=$('#paper-author').val()){
            params.author=$('#paper-author').val();
        }else{
            swal("Oops!", "作者不能为空", "error");
            return false;
        }

        if(null!=$('#paper-summary').val() && ''!=$('#paper-summary').val()){
            params.summary=$('#paper-summary').val();
        }else{
            swal("Oops!", "摘要不能为空", "error");
            return false;
        }
        var id="${id}";

        $.ajax({
            type : "post",
            url : "addPaper.htm?id="+id,
            data : JSON.stringify(params),
            contentType: "application/json",
            async : false,
            success : function(data){
                if(data =="ok"){
                    window.location.href=${siteurl}+'admin/member/profile.htm?id='+id;
                }
            },
            error: function ()
            {
                swal("Oops!", "上传论文错误", "error");
            }
        });

        return false;
    });

    $('#upload-btn').click(function(){
        $('.paper-select-input').trigger('click');
        return false;
    });

    function upLoad(){
        var id="${id}";
        var url="uploadPaper.htm?id="+id;

        var src=fileToUpload.value;
        if(src==null && src==""){
            return;
        }
        if(src.indexOf('.pdf')<0&&src.indexOf('.doc')<0&&src.indexOf('.docx')<0){
            swal("Oops!", "请选择pdf或者doc文件!", "error");
            $('.paper-select-inputt').val('');
            return;
        }
        var filesize=0;
        if(navigator.userAgent.indexOf("MSIE")>0) {
        }else{
            filesize = fileToUpload.files[0].size;
        }
        if(filesize>=5*1024*1024){
            swal("Oops!", "文件大小不能超过5M", "error");
            $('.paper-select-inputt').val('');
            return;
        }
        $.ajaxFileUpload ({
            url:url,
            secureuri:false,
            fileElementId:'fileToUpload',
            dataType:'text',
            success: function (fileDest)
            {
                if(fileDest!=null){
                    if('error'==fileDest){
                        swal("Oops!", "上传论文文件错误", "error");
                        $('.paper-select-inputt').val('');
                    }else{
                        $('#fileDirInput').val(fileDest)
                        $('#paper-link').attr('href',${siteurl}+fileDest);
                        $('#paper-link').text(fileDest.substring(fileDest.lastIndexOf('/')+1))

                        $('.paper-select-inputt').val('');
                    }
                }
            },
            error: function ()
            {
                swal("Oops!", "上传论文文件错误", "error");
                $('.paper-select-inputt').val('');
            }
        });
    }
</script>

</body>
</html>
